import { AuthContext } from "@/context/AuthContext";
import React, { useContext, useState } from "react";

interface State {
    photoURL?: string;
    error?: string;
    success?: string;
}

export function useChangeProfile() {
    const [state, setState] = useState<State>({});
    const authState = useContext(AuthContext);

    function setProfilePic(photoURL: string) {
        setState({ ...state, photoURL});
    }

    async function handleNameChange(e: React.FormEvent<HTMLFormElement>) {
        e.stopPropagation();
        e.preventDefault();
        if (!state.photoURL) {
            setState({ ...state, error: "Please upload a valid file" });
            return;
        }
        try {
            await authState?.updateProfilePic(state.photoURL);
            setState({ ...state, success: "Name updated successfully.", error: undefined });
            //navigate("/");
        } catch (err) {
            setState({
                ...state,
                error: "Name change failed. Please try again later.", 
            });
        }
    }
    return {
        success: state.success,
        error: state.error,
        handleNameChange,
        setProfilePic,
    };
}